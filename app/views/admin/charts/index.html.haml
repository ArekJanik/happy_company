= form_tag admin_charts_path, method: :get do
  TIME:
  = radio_button_tag 'time', 'month', true
  = label_tag "time_month", "Last month"
  = radio_button_tag 'time', 'week', false
  = label_tag "time_week", "Last week"
  <br/>
  TYPE:
  = radio_button_tag 'type', 'users', true, onchange: "$('#users_container').show();$('#groups_container').hide();"
  = label_tag "type_users", "Users"
  = radio_button_tag 'type', 'groups', false, onchange: "$('#users_container').hide();$('#groups_container').show();"
  = label_tag "type_groups", "Groups"
  <br/>

  %div#users_container
    - User.all.map{|u| {display_name: u.display_name, id: u.id}}.sort { |a,b| a[:display_name].downcase <=> b[:display_name].downcase }.each do |user|
      = check_box_tag "user_#{user[:id]}", user[:id], false, name: "user_ids[]"
      = label_tag "user_#{user[:id]}", user[:display_name]

  %div#groups_container
    - ParentGroup.order(:name).each do |parent_group|
      %div{id: "parent_group_#{parent_group.id}_container"}
        = check_box_tag "parent_group_#{parent_group.id}", parent_group.id, false, onclick: "check_all_groups('#{parent_group.id}')"
        = label_tag "parent_group_#{parent_group.id}", parent_group.name
        - parent_group.groups.order(:name).each do |group|
          = check_box_tag "group_#{group.id}", group.id, false, name: "groups_ids[]"
          = label_tag "group_#{group.id}", group.name

  = submit_tag "Generate"

:javascript
  function check_all_groups(id) {
    if ($("#parent_group_" + id).is(':checked'))
      $('#parent_group_' + id + '_container input[type="checkbox"]').prop("checked", true);
    else
      $('#parent_group_' + id + '_container input[type="checkbox"]').prop("checked", false);
  };
  $(function(){
    if (!$('#type_users').is(':checked'))
      $('#users_container').hide();
    if (!$('#type_group').is(':checked'))
      $('#groups_container').hide();
  });